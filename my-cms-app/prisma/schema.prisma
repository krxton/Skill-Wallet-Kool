// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =======================================================
// Entity Table
// =======================================================

// 1. Parent (ผู้ปกครอง)
model Parent {
  parentId    String   @id @default(dbgenerated("gen_random_uuid()")) @map("parent_id") @db.Uuid
  createdDate DateTime @default(now()) @map("created_date") @db.Timestamptz(6)
  nameSurname String?  @map("name_surname")
  email       String   @unique @map("email")
  userId      String?  @map("user_id") @db.Uuid

  // Relations
  activities       Activity[]
  activityRecords  ActivityRecord[]
  parentAndChild   ParentAndChild[]
  parentAndMedals  ParentAndMedals[]
  redemptions      Redemption[]

  @@map("parent")
}

// 2. Child (เด็ก)
model Child {
  childId       String    @id @default(dbgenerated("gen_random_uuid()")) @map("child_id") @db.Uuid
  createdDate   DateTime  @default(now()) @map("created_date") @db.Timestamptz(6)
  nameSurname   String?   @map("name_surname")
  birthday      DateTime? @map("birthday") @db.Timestamptz(6)
  updateWallet  Decimal?  @map("update_wallet") @db.Decimal
  wallet        Decimal?  @map("wallet") @db.Decimal

  // Relations
  activityRecords ActivityRecord[]
  parentAndChild  ParentAndChild[]
  redemptions     Redemption[]

  @@map("child")
}

// 3. Activity (กิจกรรม)
model Activity {
  activityId          String   @id @default(dbgenerated("gen_random_uuid()")) @map("activity_id") @db.Uuid
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  nameActivity        String   @map("name_activity")
  descriptionActivity String   @map("description_activity")
  levelActivity       String   @map("level_activity")
  parentId            String   @map("parent_id") @db.Uuid
  category            String   @map("category")
  content             String   @map("content")
  maxscore            Decimal  @map("maxscore") @db.Decimal
  videourl            String?  @map("videourl")
  segments            Json?    @map("segments") @db.JsonB
  thumbnailurl        String?  @map("thumbnailurl")
  tiktokhtmlcontent   String?  @map("tiktokhtmlcontent")
  updateAt            DateTime @map("update_at") @db.Timestamptz(6)
  playCount           Decimal? @map("play_count") @db.Decimal

  // Relations
  parent Parent @relation(fields: [parentId], references: [parentId])

  @@map("activity")
}

// 4. Medals (รางวัล)
model Medals {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @map("id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  nameMedals  String?  @map("name_medals")
  pointMedals Decimal? @map("point_medals") @db.Decimal

  // Relations
  activityRecords ActivityRecord[]
  parentAndMedals ParentAndMedals[]
  redemptions     Redemption[]

  @@map("medals")
}

// =======================================================
// Junction Table
// =======================================================

// 5. ParentAndChild (ผู้ปกครอง-เด็ก)
model ParentAndChild {
  parentChildId String   @id @default(dbgenerated("gen_random_uuid()")) @map("parent_child_id") @db.Uuid
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  parentId      String?  @map("parent_id") @db.Uuid
  childId       String?  @map("child_id") @db.Uuid
  relationship  String?  @map("relationship")

  // Relations
  parent Parent? @relation(fields: [parentId], references: [parentId], onUpdate: Cascade, onDelete: Cascade)
  child  Child?  @relation(fields: [childId], references: [childId], onUpdate: Cascade, onDelete: Cascade)

  @@map("parent_and_child")
}

// 6. ParentAndMedals (ผู้ปกครอง-รางวัล)
model ParentAndMedals {
  parentMedalsId String   @id @default(dbgenerated("gen_random_uuid()")) @map("parent_medals_id") @db.Uuid
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  parentId       String?  @map("parent_id") @db.Uuid
  medalsId       String?  @map("medals_id") @db.Uuid

  // Relations
  parent Parent? @relation(fields: [parentId], references: [parentId], onUpdate: Cascade, onDelete: Cascade)
  medals Medals? @relation(fields: [medalsId], references: [id])

  @@map("parent_and_medals")
}

// 7. ActivityRecord (บันทึกการทำกิจกรรม)
model ActivityRecord {
  activityRecordId String    @id @default(dbgenerated("gen_random_uuid()")) @map("ActivityRecord_id") @db.Uuid
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  parentId         String?   @map("parent_id") @db.Uuid
  childId          String?   @map("child_id") @db.Uuid
  medalsId         String?   @map("medals_id") @db.Uuid
  point            Decimal?  @map("point") @db.Decimal
  timeSpent        Decimal?  @map("time_spent") @db.Decimal
  date             DateTime? @map("date") @db.Timestamptz(6)

  // Relations
  parent Parent? @relation(fields: [parentId], references: [parentId], onUpdate: Cascade, onDelete: Cascade)
  child  Child?  @relation(fields: [childId], references: [childId])
  medals Medals? @relation(fields: [medalsId], references: [id])

  @@map("activity_record")
}

// 8. Redemption (แลกรางวัล)
model Redemption {
  redemptionId     String    @id @default(dbgenerated("gen_random_uuid()")) @map("redemption_id") @db.Uuid
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  dateRedemption   DateTime? @map("date_redemption") @db.Timestamptz(6)
  pointForReward   Decimal?  @map("point_for_reward") @db.Decimal
  childId          String?   @map("child_id") @db.Uuid
  medalsId         String?   @map("medals_id") @db.Uuid
  parentId         String?   @map("parent_id") @db.Uuid

  // Relations
  child  Child?  @relation(fields: [childId], references: [childId])
  medals Medals? @relation(fields: [medalsId], references: [id])
  parent Parent? @relation(fields: [parentId], references: [parentId], onUpdate: Cascade, onDelete: Cascade)

  @@map("redemption")
}
